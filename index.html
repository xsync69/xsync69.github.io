<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title id="page-title">xSync69 - xsync69.</title>
    <meta name="description" content="Personal profile" />
    <meta name="theme-color" content="#7c3aed" id="theme-color-meta" />
    <link rel="preload" as="image" href="assets/ace.png" />
    <link rel="icon" href="assets/ace.png" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="bg"></div>

  <header class="navbar" role="navigation">
      <div class="nav-inner">
        <a href="#home" class="brand" id="brand">xsync69</a>
        <nav class="nav-links" aria-label="Primary">
      <a id="contact-link" href="#contact">Contact</a>
          <a href="#info" data-nav-link>Info</a>
        </nav>
  <a id="join-server" class="btn nav-cta" href="#" target="_blank" rel="noopener noreferrer">Join Server</a>
  <button id="music-toggle" class="btn music-btn" aria-pressed="false" title="Play or pause background music">
          Play Music
        </button>
      </div>
      <audio id="bg-audio" loop preload="auto"></audio>
    </header>

    <main class="card" role="main">
      <section id="home-section" class="route route-home">
        <img id="avatar" class="avatar" alt="Profile picture" src="assets/ace.png" />

        <h1 id="name">xsync69</h1>
        <p id="bio" class="bio">no</p>

        <div class="cta-row">
          <a id="join-server-home" class="btn cta-large" href="#" target="_blank" rel="noopener noreferrer">Join Server</a>
        </div>

        <div class="discord">
          <span class="discord-label">Discord</span>
          <div class="discord-row">
            <code id="discord-username">xsync69.</code>
            <button id="copy-discord" class="btn copy" aria-label="Copy Discord username" title="Copy">
              Copy
            </button>
          </div>
          <p id="discord-note" class="discord-note"></p>
        </div>

        <ul id="links" class="links" aria-label="Links"></ul>

        <footer class="footer">
          <small>Â© <span id="year"></span> <span id="name-footer">xsync69</span><br><span> Warning: We log ip addresses to prevent bots.</span></br></small>
        </footer>
      </section>

      <section id="contact-section" class="route route-contact" hidden>
        <h1>Contact</h1>
        <p>Discord: <code id="contact-discord">@username</code></p>
        <p id="contact-email-wrap" class="bio">Email: <a id="contact-email" href="#">your@email.com</a></p>
        <p class="bio">You can update contact info in <code>data.json</code>.</p>
      </section>

      <section id="info-section" class="route route-info" hidden>
        <h1>Info</h1>
  <p id="info-bio" class="bio">This is where your info/about text goes.</p>
  <h3>Products</h3>
  <ul id="products" class="products"></ul>
  <p id="info-buy-line" class="bio">DM to buy.</p>
      </section>
      <div id="admin-entry" hidden style="text-align:center; margin:16px 0;">
        <button id="open-admin" class="btn">Open Admin Dashboard</button>
      </div>
    </main>
    <script src="script.js" defer></script>
    <script>
      (function () {
        const params = new URLSearchParams(location.search);
        if (params.get('admin') === '1') {
          document.getElementById('admin-entry')?.removeAttribute('hidden');
          document.getElementById('open-admin')?.addEventListener('click', async () => {
            const key = prompt('Enter admin key');
            if (!key) return;
            try {
              const res = await fetch(`/api/stats?key=${encodeURIComponent(key)}`);
              if (!res.ok) throw new Error('Unauthorized or server error');
              const data = await res.json();
              const modal = document.createElement('div');
              modal.className = 'modal-backdrop';
              const box = document.createElement('div');
              box.className = 'modal-box';
              box.style.maxWidth = '820px';
              const title = document.createElement('h3');
              title.textContent = 'Admin Stats';
              const summary = document.createElement('div');
              summary.style.marginBottom = '10px';
              summary.innerHTML = `
                <strong>Total:</strong> ${data.total} &nbsp; 
                <strong>Unique IPs:</strong> ${data.uniqueIPs} &nbsp; 
                <strong>Bots:</strong> ${data.bots} &nbsp; 
                <strong>Humans:</strong> ${data.humans}
              `;
              // Table for recent entries
              const tableWrap = document.createElement('div');
              tableWrap.style.maxHeight = '60vh';
              tableWrap.style.overflow = 'auto';
              const table = document.createElement('table');
              table.style.width = '100%';
              table.style.borderCollapse = 'collapse';
              const thead = document.createElement('thead');
              const headerRow = document.createElement('tr');
              ['Time','IP','Country','City','ISP','Bot','Event'].forEach(h => {
                const th = document.createElement('th');
                th.textContent = h;
                th.style.textAlign = 'left';
                th.style.padding = '6px 8px';
                th.style.borderBottom = '1px solid var(--border)';
                headerRow.appendChild(th);
              });
              thead.appendChild(headerRow);
              table.appendChild(thead);
              const tbody = document.createElement('tbody');
              (data.recent || []).forEach(it => {
                const tr = document.createElement('tr');
                const time = new Date(it.ts || it.ts || Date.now()).toLocaleString();
                [[time],[it.ip],[it.country||''],[it.city||''],[it.isp||''],[it.bot? 'Yes': 'No'],[it.clientEvent||'']].forEach((v, i) => {
                  const td = document.createElement('td');
                  td.textContent = Array.isArray(v) ? v[0] : v;
                  td.style.padding = '6px 8px';
                  td.style.borderBottom = '1px solid rgba(0,0,0,.06)';
                  tr.appendChild(td);
                });
                tbody.appendChild(tr);
              });
              table.appendChild(tbody);
              tableWrap.appendChild(table);

              const exportBtn = document.createElement('button');
              exportBtn.className = 'btn';
              exportBtn.textContent = 'Export CSV';
              exportBtn.style.margin = '10px 8px 0 0';
              exportBtn.addEventListener('click', () => {
                const rows = [['Time','IP','Country','City','ISP','Bot','Event']];
                (data.recent || []).forEach(it => {
                  rows.push([
                    it.ts || '', it.ip || '', it.country || '', it.city || '', it.isp || '', it.bot ? 'Yes' : 'No', it.clientEvent || ''
                  ]);
                });
                const csv = rows.map(r => r.map(c => '"' + String(c).replace(/"/g,'""') + '"').join(',')).join('\n');
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = 'recent-logs.csv';
                document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
              });

              const close = document.createElement('button');
              close.className = 'btn';
              close.textContent = 'Close';
              close.addEventListener('click', () => modal.remove());
              box.appendChild(title);
              box.appendChild(summary);
              box.appendChild(tableWrap);
              box.appendChild(exportBtn);
              box.appendChild(close);
              modal.appendChild(box);
              modal.addEventListener('click', (e) => { if (e.target === modal) modal.remove(); });
              document.body.appendChild(modal);
            } catch (e) {
              alert('Failed to load admin stats');
            }
          });
        }
      })();
    </script>
  </body>
</html>