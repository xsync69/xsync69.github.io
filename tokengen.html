<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>x69 — Token Generator</title>
  <meta name="description" content="Buy Token Generator access with BTC / ETH / LTC." />
  <link rel="icon" href="assets/bg.gif" type="image/gif" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: {
        colors:{ brand:{DEFAULT:"#7c3aed",dark:"#6d28d9"} },
        boxShadow:{ glow:"0 0 30px rgba(124,58,237,.35)", btn:"0 10px 30px rgba(124,58,237,.35)" }
      }}
    }
  </script>

  <style>
    :root { --bg-gif: url('assets/bg.gif'); }
    html,body{height:100%}
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;background:#050505;color:#fff}
    .hero-bg{position:fixed;inset:0;z-index:-10;background:radial-gradient(60% 40% at 50% 10%,rgba(124,58,237,.20),transparent 60%),#050505}
    .hero-bg::before{content:"";position:absolute;inset:-10%;background-image:var(--bg-gif);background-size:cover;background-position:center;opacity:.18;filter:contrast(1.05) saturate(1.05) brightness(.75);animation:pan 40s linear infinite}
    @keyframes pan{0%{transform:scale(1.08)}50%{transform:scale(1.1) translate(-2%,-2%)}100%{transform:scale(1.08)}}
    .glass{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.06);border-radius:16px}
    .card{padding:20px;border-radius:14px}
    .mon{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,"Roboto Mono",monospace}
    .small{font-size:.95rem;color:rgba(255,255,255,.78)}
    .btn{display:inline-flex;align-items:center;justify-content:center;border-radius:14px;padding:.9rem 1.2rem;font-weight:700;transition:transform .15s, box-shadow .2s}
    .btn:active{transform:translateY(1px)}
    .btn-buy{background:linear-gradient(135deg,#7c3aed,#6d28d9);box-shadow:0 8px 22px rgba(124,58,237,.35);color:#fff}
    .btn-buy:hover{filter:brightness(1.05);box-shadow:0 14px 34px rgba(124,58,237,.45)}
    .btn-ghost{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12)}
    .btn-ghost:hover{background:rgba(255,255,255,.14)}
    .icon{width:1.15em;height:1.15em;margin-right:.5rem;display:inline-block;vertical-align:-0.2em}
    .coin-pill{display:inline-flex;align-items:center;gap:.4rem;padding:.55rem .9rem;border-radius:10px;border:1px solid rgba(255,255,255,.12);cursor:pointer;background:rgba(255,255,255,.06)}
    .coin-pill.active{border-color:#22c55e;background:rgba(34,197,94,.12)}
    .copy-btn{background:transparent;border:1px solid rgba(255,255,255,.12);padding:.45rem .7rem;border-radius:10px;cursor:pointer}
    /* spinner */
    .spinner-wrap{position:relative;width:28px;height:28px}
    .spinner{position:absolute;inset:0;border:4px solid rgba(34,197,94,.18);border-left-color:#22c55e;border-radius:50%;animation:spin 1s linear infinite}
    .spinner-halo{position:absolute;inset:-6px;border-radius:50%;box-shadow:0 0 0 0 rgba(34,197,94,.35);animation:halo 1.6s ease-out infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    @keyframes halo{0%{box-shadow:0 0 0 0 rgba(34,197,94,.35)}70%{box-shadow:0 0 0 10px rgba(34,197,94,0)}100%{box-shadow:0 0 0 0 rgba(34,197,94,0)}}
  </style>
</head>
<body>
  <div class="hero-bg" aria-hidden="true"></div>

  <!-- NAV (same as homepage, but without "Token Generator") -->
  <header class="sticky top-0 z-40 bg-neutral-900/60 backdrop-blur border-b border-white/5">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="index.html#home" class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-xl bg-brand grid place-items-center">⚡</div>
        <div class="font-semibold">x69 Sniper</div>
      </a>
      <nav class="hidden md:flex gap-6 text-sm small">
        <a href="index.html#features" class="hover:text-brand">Features</a>
        <a href="index.html#products" class="hover:text-brand">Products</a>
        <!-- Token Generator omitted on this page -->
        <a href="index.html#faq" class="hover:text-brand">FAQ</a>
        <a href="index.html#discord" class="hover:text-brand">Discord</a>
      </nav>
      <div class="flex items-center gap-3">
        <a href="index.html#products" class="btn btn-buy">Buy</a>
        <a href="index.html#discord" class="btn btn-ghost">
          <svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M20.317 4.369A19.791 19.791 0 0 0 16.558 3c-.2.36-.43.85-.59 1.23a18.27 18.27 0 0 0-7.936 0c-.17-.39-.4-.87-.6-1.23-1.36.25-2.67.68-3.95 1.37C.75 9.12-.46 13.75.14 18.31a19.9 19.9 0 0 0 6.1 2.69c.47-.64.89-1.32 1.25-2.03-.68-.25-1.33-.56-1.94-.92.16-.12.32-.25.47-.38 3.72 1.73 7.75 1.73 11.45 0 .16.13.31.26.47.38-.61.36-1.26.67-1.94.92.36.71.78 1.39 1.25 2.03a19.9 19.9 0 0 0 6.1-2.69c.55-4.25-.44-8.83-3.03-13.94ZM8.6 14.64c-1.03 0-1.87-.95-1.87-2.12 0-1.16.83-2.11 1.87-2.11 1.03 0 1.87.95 1.87 2.11 0 1.17-.84 2.12-1.87 2.12Zm6.81 0c-1.03 0-1.87-.95-1.87-2.12 0-1.16.83-2.11 1.87-2.11s1.87.95 1.87 2.11c0 1.17-.84 2.12-1.87 2.12Z"/></svg>
          Join Discord
        </a>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <section class="py-10">
      <h1 class="text-3xl font-extrabold">Token Generator</h1>
      <p class="small mt-2 text-white/70">Purchase access and start generating. Live activity below is simulated.</p>
    </section>

    <!-- Live console -->
    <section class="glass card">
      <div class="text-xs uppercase tracking-wide text-white/60">x69 Token Generator Live Logs [Can be delayed by up to 6 seconds]</div>
      <div id="console" class="mon mt-3 bg-black/60 border border-white/10 rounded-xl p-4 text-sm leading-relaxed overflow-auto"
           style="max-height:260px"></div>
    </section>

    <!-- Buy + Payment -->
    <section class="grid lg:grid-cols-2 gap-6 mt-8">
      <div class="glass card">
        <h2 class="text-xl font-bold">Plans</h2>
        <div class="mt-4 grid sm:grid-cols-2 gap-4">
          <div class="glass p-4 rounded-xl">
            <div class="font-semibold">Day</div>
            <div class="text-3xl font-extrabold mt-1">£10</div>
          </div>
          <div class="glass p-4 rounded-xl">
            <div class="font-semibold">Month</div>
            <div class="text-3xl font-extrabold mt-1">£24.99</div>
          </div>
          <div class="glass p-4 rounded-xl">
            <div class="font-semibold">Year</div>
            <div class="text-3xl font-extrabold mt-1">£59.99</div>
          </div>
          <div class="glass p-4 rounded-xl">
            <div class="font-semibold">Lifetime</div>
            <div class="text-3xl font-extrabold mt-1">£89.99</div>
          </div>
        </div>
        <p class="small text-white/70 mt-4">Choose a plan on the right, enter your Discord username and pay with BTC, ETH or LTC.</p>
      </div>

      <div class="grid gap-6">
        <div class="glass card">
          <h2 class="text-xl font-bold">Buy Access</h2>
          <div class="mt-4 grid gap-3">
            <label class="small">Discord username</label>
            <input id="discordUsername" placeholder="@yourname" class="w-full bg-neutral-900/40 border border-white/10 rounded-lg px-3 py-2" />

            <label class="small mt-2">Plan</label>
            <select id="plan" class="w-full bg-neutral-900/40 border border-white/10 rounded-lg px-3 py-2">
              <option value="day" data-price="10.00">Day — £10</option>
              <option value="month" data-price="24.99">Month — £24.99</option>
              <option value="year" data-price="59.99">Year — £59.99</option>
              <option value="lifetime" data-price="89.99">Lifetime — £89.99</option>
            </select>

            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="small">Coin</label>
                <div id="coinPills" class="flex gap-2 mt-1">
                  <button class="coin-pill active" data-coin="btc">BTC</button>
                  <button class="coin-pill" data-coin="eth">ETH</button>
                  <button class="coin-pill" data-coin="ltc">LTC</button>
                </div>
                <input type="hidden" id="coin" value="btc" />
              </div>
              <div class="small">
                <div>Price (GBP): <strong id="priceGBP">£10.00</strong></div>
                <div class="mt-1">Approx crypto: <strong id="cryptoAmt">—</strong></div>
              </div>
            </div>

            <button id="buyNowBtn" class="btn btn-buy w-full mt-2">Buy Now</button>
            <div class="small text-white/60">After payment, click <strong>I Sent the Payment</strong> to verify on-chain.</div>
          </div>
        </div>

        <div class="glass card">
          <h3 class="text-lg font-bold">Payment Card</h3>
          <div id="paymentArea" class="small text-white/60 mt-3">No invoice created yet.</div>
        </div>
      </div>
    </section>

    <div class="mt-10 flex gap-3">
      <a href="index.html#products" class="btn btn-ghost">← Back to store</a>
      <a href="index.html#discord" class="btn btn-ghost">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M20.317 4.369A19.791 19.791 0 0 0 16.558 3c-.2.36-.43.85-.59 1.23a18.27 18.27 0 0 0-7.936 0c-.17-.39-.4-.87-.6-1.23-1.36.25-2.67.68-3.95 1.37C.75 9.12-.46 13.75.14 18.31a19.9 19.9 0 0 0 6.1 2.69c.47-.64.89-1.32 1.25-2.03-.68-.25-1.33-.56-1.94-.92.16-.12.32-.25.47-.38 3.72 1.73 7.75 1.73 11.45 0 .16.13.31.26.47.38-.61.36-1.26.67-1.94.92.36.71.78 1.39 1.25 2.03a19.9 19.9 0 0 0 6.1-2.69c.55-4.25-.44-8.83-3.03-13.94ZM8.6 14.64c-1.03 0-1.87-.95-1.87-2.12 0-1.16.83-2.11 1.87-2.11 1.03 0 1.87.95 1.87 2.11 0 1.17-.84 2.12-1.87 2.12Zm6.81 0c-1.03 0-1.87-.95-1.87-2.12 0-1.16.83-2.11 1.87-2.11s1.87.95 1.87 2.11c0 1.17-.84 2.12-1.87 2.12Z"/></svg>
        Join Discord
      </a>
    </div>
  </main>

  <script>
    // ===== Colorized live console (5–20s) =====
    const con = document.getElementById('console');
    const MAX_LINES = 120;

    function maskUsername() {
      const len = 4 + Math.floor(Math.random()*4); // 4–7
      return "<span style='color:#60a5fa'>" + "*".repeat(len) + "</span>";
    }
    const ok = t => `<span style="color:#10b981">${t}</span>`;
    const bad = t => `<span style="color:#f87171">${t}</span>`;
    const tok = () => `<strong style="color:#22c55e">hidden</strong>`;
    const failChance = (p=0.1)=> Math.random() < p;
    const boolTxt = (pFalse=0.1)=> Math.random() < pFalse ? bad("False") : ok("True");

    function renderLine(){
      const emailField = failChance(0.1) ? bad("Failed") : ok("Success");
      const phoneField = failChance(0.1) ? bad("Failed") : ok("Success");

      const parts = [
        "[Token Created]",
        `[Username: ${maskUsername()}]`,
        `[Token: ${tok()}]`,
        `[Status: ${ok("Verified")}]`,
        `[Email: ${emailField}]`,
        `[Phone: ${phoneField}]`,
        `[Joined Server: ${boolTxt(0.1)}]`
      ];
      const row = `<div>${new Date().toLocaleTimeString()}  ${parts.join(" ")}</div>`;
      con.insertAdjacentHTML("beforeend", row);
      while (con.children.length > MAX_LINES) con.removeChild(con.firstChild);
      con.scrollTop = con.scrollHeight;

      setTimeout(renderLine, 5000 + Math.random()*15000); // 5–20s
    }
    for(let i=0;i<3;i++) setTimeout(renderLine, i*400);

    // ===== CONFIG (match your Worker endpoints) =====
    const API_BASE   = "https://x69-verifier.lewischeron.workers.dev"; // or your workers.dev base
    const ORDER_URL  = API_BASE + "/order-created";
    const VERIFY_URL = API_BASE + "/report-and-verify";

    const WALLETS = {
      btc: "bc1q0dsy3av06tw8nwaty5fy8685pueetqql7pswk6",
      eth: "0x4cc0da68E16ea4ddb49D0ec392692B1Adf262c13",
      ltc: "LWuZEBNukhNcVp6vM1pVjBVSxV6pooDK7C"
    };

    // ===== Rates + Purchase flow =====
    const priceGBPEl = document.getElementById('priceGBP');
    const cryptoAmtEl = document.getElementById('cryptoAmt');
    const planSel = document.getElementById('plan');
    const coinPills = document.getElementById('coinPills');
    const coinHidden = document.getElementById('coin');
    const paymentArea = document.getElementById('paymentArea');

    let rates = { btc_gbp:null, eth_gbp:null, ltc_gbp:null };
    const COINGECKO = "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,litecoin&vs_currencies=gbp";

    async function fetchRates(){
      try {
        const r = await fetch(COINGECKO, { cache:'no-store' });
        const d = await r.json();
        rates.btc_gbp = +d.bitcoin.gbp; rates.eth_gbp = +d.ethereum.gbp; rates.ltc_gbp = +d.litecoin.gbp;
        updateApprox();
      } catch {}
    }
    function updateApprox(){
      const coin = coinHidden.value;
      const price = +planSel.selectedOptions[0].dataset.price;
      if (priceGBPEl) priceGBPEl.textContent = `£${price.toFixed(2)}`;
      let approx = "—";
      if(rates.btc_gbp){
        if(coin==='btc') approx=(price/rates.btc_gbp).toFixed(8)+" BTC";
        if(coin==='eth') approx=(price/rates.eth_gbp).toFixed(6)+" ETH";
        if(coin==='ltc') approx=(price/rates.ltc_gbp).toFixed(6)+" LTC";
      }
      if (cryptoAmtEl) cryptoAmtEl.textContent = approx;
    }
    coinPills.addEventListener('click', e=>{
      const btn = e.target.closest('.coin-pill'); if(!btn) return;
      coinPills.querySelectorAll('.coin-pill').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active'); coinHidden.value = btn.dataset.coin; updateApprox();
    });
    planSel.addEventListener('change', updateApprox);

    function newInvoiceId(){ return `tokgen_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,7)}`; }
    function buildURI(coin, address, cryptoStr){
      if(!cryptoStr || cryptoStr==='—') return null;
      const amount = cryptoStr.split(' ')[0];
      if(coin==='btc') return `bitcoin:${address}?amount=${amount}`;
      if(coin==='ltc') return `litecoin:${address}?amount=${amount}`;
      if(coin==='eth') return `ethereum:${address}?value=${amount}`;
      return null;
    }

    function renderInvoice({invoiceId, discordUsername, planLabel, price, coin, cryptoStr, address}){
      const el=document.createElement('div');
      el.className='glass p-4 rounded-xl';
      el.innerHTML = `
        <div class="mon">
          <div class="text-white/80">Invoice • <span class="text-white/60">${invoiceId}</span></div>
          <div class="mt-2"><strong>Discord:</strong> ${discordUsername}</div>
          <div class="mt-1"><strong>Product:</strong> Token Generator</div>
          <div class="mt-1"><strong>Plan:</strong> ${planLabel}</div>
          <div class="mt-1"><strong>Total (GBP):</strong> £${price.toFixed(2)}</div>
          <div class="mt-1"><strong>Amount:</strong> <span>${cryptoStr}</span></div>
          <div class="mt-1"><strong>Send to:</strong> <span>${address}</span></div>
          <div class="mt-3 flex gap-2 flex-wrap">
            <button class="copy-btn" id="copyAmountBtn">Copy amount</button>
            <button class="copy-btn" id="copyAddrBtn">Copy address</button>
            <button class="copy-btn" id="openWalletBtn">Open in wallet</button>
            <button class="copy-btn" id="sentPaymentBtn">I Sent the Payment</button>
          </div>
          <div class="mt-3 flex items-center gap-3">
            <div class="spinner-wrap"><div class="spinner"></div><div class="spinner-halo"></div></div>
            <div id="awaitText" class="small">Awaiting transfer… click the button after you send.</div>
          </div>
        </div>
      `;

      const copyAmountBtn=el.querySelector('#copyAmountBtn');
      const copyAddrBtn=el.querySelector('#copyAddrBtn');
      const openWalletBtn=el.querySelector('#openWalletBtn');
      const sentPaymentBtn=el.querySelector('#sentPaymentBtn');
      const awaitText=el.querySelector('#awaitText');

      copyAmountBtn.addEventListener('click', async ()=>{ const amt=cryptoStr.split(' ')[0]||''; try{ await navigator.clipboard.writeText(amt); copyAmountBtn.textContent='Copied ✓'; setTimeout(()=>copyAmountBtn.textContent='Copy amount',1200);}catch{ prompt('Copy amount', amt);} });
      copyAddrBtn.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(address); copyAddrBtn.textContent='Copied ✓'; setTimeout(()=>copyAddrBtn.textContent='Copy address',1200);}catch{ prompt('Copy address', address);} });
      openWalletBtn.addEventListener('click', ()=>{ const uri=buildURI(coin, address, cryptoStr); if(!uri){ alert('No wallet URI available.'); return; } window.location.href=uri; });

      sentPaymentBtn.addEventListener('click', async ()=>{
        sentPaymentBtn.disabled = true;
        awaitText.textContent = 'Verifying on-chain via Blockchair…';
        try{
          const res = await fetch(VERIFY_URL, {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({
              invoiceId, discordUsername, product:"Token Generator", option: planLabel,
              coin, address, amountCoin: Number(cryptoStr.split(' ')[0]||'0'), amountGBP: Number(price.toFixed(2)), qty: 1
            })
          });
          const data = await res.json().catch(()=> ({}));
          if(!res.ok || !data.ok){ sentPaymentBtn.disabled=false; awaitText.textContent=data?.error || 'Not paid yet. Try again soon.'; awaitText.style.color='#fca5a5'; return; }
          awaitText.textContent='Verified ✓ — order sent to Discord. Thank you!'; awaitText.style.color='#a3f3c8';
        }catch{ sentPaymentBtn.disabled=false; awaitText.textContent='Server error contacting verifier. Try again.'; awaitText.style.color='#fca5a5'; }
      });

      return el;
    }

    document.getElementById('buyNowBtn').addEventListener('click', async ()=>{
      const discordUsername = document.getElementById('discordUsername').value.trim();
      if(!discordUsername){ alert('Enter your Discord username (e.g. @yourname).'); return; }
      const coin = document.getElementById('coin').value;
      const address = WALLETS[coin];
      const sel = planSel.selectedOptions[0];
      const price = +sel.dataset.price;
      const planLabel = sel.textContent;

      let cryptoStr='—';
      if(rates.btc_gbp){
        if(coin==='btc') cryptoStr=(price/rates.btc_gbp).toFixed(8)+' BTC';
        if(coin==='eth') cryptoStr=(price/rates.eth_gbp).toFixed(6)+' ETH';
        if(coin==='ltc') cryptoStr=(price/rates.ltc_gbp).toFixed(6)+' LTC';
      }

      const invoiceId = newInvoiceId();

      // Send "Order Created" embed
      try{
        await fetch(ORDER_URL, {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({
            invoiceId, discordUsername, product:"Token Generator", option: planLabel,
            coin, address, amountCoin: Number((cryptoStr.split(' ')[0]||'0')), amountGBP: Number(price.toFixed(2)), qty: 1
          })
        });
      }catch{}

      // Render invoice
      paymentArea.innerHTML = '';
      paymentArea.appendChild(renderInvoice({invoiceId, discordUsername, planLabel, price, coin, cryptoStr, address}));
    });

    fetchRates(); setInterval(fetchRates, 60000); updateApprox();
  </script>
</body>
</html>

